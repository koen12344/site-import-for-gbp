<?php

namespace Koen12344\SiteImportForGbp;

use Koen12344\SiteImportForGbp\DependencyInjection\Container;

class Plugin {
	const DOMAIN = 'site-import-for-gbp';

	const VERSION = '0.1.0';

	const DASHICON = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB3aWR0aD0iMjAiCiAgIGhlaWdodD0iMjAiCiAgIHZpZXdCb3g9IjAgMCAxMDUuMDE2ODUgOTIuNDgyMjE2IgogICB2ZXJzaW9uPSIxLjEiCiAgIGlkPSJzdmczMzUiCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPGRlZnMKICAgICBpZD0iZGVmczMzMiI+CiAgICA8Y2xpcFBhdGgKICAgICAgIGNsaXBQYXRoVW5pdHM9InVzZXJTcGFjZU9uVXNlIgogICAgICAgaWQ9ImNsaXBQYXRoMTAyMzciPgogICAgICA8cmVjdAogICAgICAgICBzdHlsZT0iZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxLjU4MzM7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjYuMztzdHJva2UtZGFzaGFycmF5OjEuNTgzMywgMS41ODMzIgogICAgICAgICBpZD0icmVjdDEwMjM5IgogICAgICAgICB3aWR0aD0iMjYyLjQxMDQiCiAgICAgICAgIGhlaWdodD0iMjYyLjQxMDQiCiAgICAgICAgIHg9Ii0yNy42NDI2OTMiCiAgICAgICAgIHk9Ii0yNy40ODU0NzQiIC8+CiAgICA8L2NsaXBQYXRoPgogIDwvZGVmcz4KICA8ZwogICAgIGlkPSJsYXllcjEiCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTU4LjczOTA0OSwtMTA2LjIwOTAyKSI+CiAgICA8ZwogICAgICAgaWQ9ImcxMjQ0OSIKICAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE4Ljk0OTk4LDE0LjU3NDM0OSkiCiAgICAgICBzdHlsZT0iZmlsbDojMDAwMDAwIj4KICAgICAgPGcKICAgICAgICAgaWQ9IkxheWVyJTIwMSIKICAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMC41MTEzNDE1NiwwLDAsMC41MTEzNDE1NiwzOS4zNDE3ODQsODQuODM5ODI4KSIKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMCIKICAgICAgICAgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMTAyMzcpIj4KCQk8cGF0aAogICBpZD0icGF0aDY0ODQiCiAgIHN0eWxlPSJmaWxsOiMwMDAwMDAiCiAgIGQ9Im0gMjMuODc1MDksMTMuMjg4MjY5IGMgLTEuNzQ5OTk3LDAgLTQuNzQ5NTg1LDEuMjUwNzQzIC02LjI0OTU4MiwzLjUwMDczNSAtMC43NDk5OTcsMC43NDk5OTkgLTEuMjUwNzQ4LDEuNzQ5ODU5IC0xLjUwMDc0OCwyLjc0OTg1NiAtMi40OTk5OTIsOC43NDk5NzQgLTQuNzUwNDY3LDE4LjAwMDM2IC03LjAwMDQ2MDcsMjcuMDAwMzMzIC0wLjc0OTk5NzYsMi4yNDk5OTQgLTEuNDk5OTg4Nyw1LjI1MDMzNiAtMS45OTk5ODcyLDcuNzUwMzMgLTAuOTk5OTk3LDMuOTk5OTg4IC0xLjk5OTA5ODYsOC40OTkxNzQgLTMuMjQ5MDk1LDEyLjQ5OTE2MiAtMC45OTk5OTcsMy45OTk5ODggLTMuMDAwNDg2MTQsMTEuMDAwMzA3IC0zLjAwMDQ4NjE0LDExLjc1MDMwNCAwLDcuOTMwMTc2IDQuNDI3NTMzNTQsMTQuNjU0NjUzIDEwLjY2NDkxNDA0LDE4LjUxMDI0MSAzLjU5Mzc5MSwyLjIyMDg5NCA3Ljc5MDEyOSwzLjQ4OTYyIDEyLjA4NDgxNCwzLjQ4OTYyIDkuOTk5OTcsMCAyMC43NTA3NDYsLTYuNDk5Nzg1IDIyLjc1MDc0LC0yMC43NDk3NDIgdiAtMS40NDYxNzYgLTEuMjg3NTExIC0yLjAxNjE1NyBsIDcuOTk5OTQ5LC02MS43NTA5OTUgeiBtIDM4Ljk5OTI0NSwwLjA1NTU4IC04LjI0ODU1Nyw2Mi45OTkwOTMgdiAwLjcxMjQ3NiAzLjI4NzQ5OCBjIDAsMC40OTk5OTggMC43NDg3MjgsNC41MDEyMjggMS40OTg3MjcsNi41MDEyMjIgNC43NDk5ODUsMTAuMjQ5OTcgMTMuMjUwMzkzLDEzLjc0ODI3MiAyMS4wMDAzNzEsMTMuNzQ4MjcyIDkuNDk5OTcxLDAgMTkuNzQ5NDg2LC02LjI0ODY1NiAyMi4yNDk0NzksLTE5LjQ5ODYxNCBWIDc3LjA1NTQyMSAxMy4zNDM4NTIgWiBtIDQ1LjEyNjU0NSwwIHYgNjMuNzExNTY5IDIuMjg2OTk5IGMgMCwwLjQ5OTk5OCAwLjI0ODg2LDMuNTAwNDc5IDAuNzQ4ODYsNS4wMDA0NzQgMy40OTk5OSwxMS43NDk5NjYgMTMuMjQ5MjYsMTYuMjQ5NTE5IDIxLjc0OTIzLDE2LjI0OTUxOSAxMC43NDk5NywwIDIxLjc1MTEyLC03Ljk5ODg5MyAyMi41MDExMiwtMjEuOTk4ODUxIEwgMTUyLjgwMSw3Ny4wNTU0MjEgMTQ0LjQ5OTg5LDEzLjM0Mzg1MiBaIG0gNDUuMjQ4ODMsMC4wMzAzMiB2IDEuNTAwNzQ4IGMgMCwwLjQ5OTk5OCAzLjQ5OTQ2LDI1Ljc1MDA0NiA0Ljk5OTQ2LDM4LjUwMDAwNyAwLjk5OTk4LDcuMjQ5OTc5IDIuMjUxNSwxNC45OTk3NTMgMy4wMDE1LDIyLjc0OTcyOSAwLjA0NjksMC4zMDUgMC4wODg0LDAuNjE3NTY3IDAuMTI0MywwLjkzMDc2NyAwLjM0NTIsMy4wMjMzOTEgMC4yNjYxNyw2LjM5OTczOCAxLjYyNTA1LDkuNTcwNDI5IDQuNSwxMC4yNDk5NyAxMy4wMDA3OCwxMy45OTg5MDEgMjAuNzUwNzUsMTMuOTk4OTAxIDQuMzQzMzgsMCA4LjY4Nzk4LC0xLjMwNDg1NSAxMi4zODM5NiwtMy42NTQzNDggNS44NzcwOSwtMy43MzYwODkgMTAuMTE1MTQsLTEwLjExNDkxNyAxMC4xMTUxNCwtMTguMDk1ODkzIDAsLTMuNzQ5OTg4IC0xMi40OTkyOCwtNDguMjQ5NTQzIC0xMy43NDkyOCwtNTQuNzQ5NTI0IC0wLjc1LC0zLjk5OTk4OCAtMy4yNTA0NywtMTAuNzUwODE2IC05LjAwMDQ1LC0xMC43NTA4MTYgeiBNIDEwMy41MjA4Nyw5My4wOTQ3MzMgQyA5Ny42NjE5ODEsMTAzLjcwMTcgODcuMjY3OTI2LDEwOC44NDI5OSA3Ni44NzUyNTcsMTA4Ljg0Mjk5IGMgLTExLjI3NjU2NywwIC0yMS4xOTI3ODEsLTYuMzQ2MzggLTI2LjQ2OTc2NiwtMTUuNTI3OTQ1IC02LjAwNTU4MiwxMC43OTU4NjUgLTE3LjAwMDM1OSwxNS40NzQzODUgLTI2Ljc4MTAzMiwxNS40NzQzODUgLTQuMDczOTg3LDAgLTguMTgzOTI2LC0wLjY4NDIzIC0xMi4wODQ4MTQsLTIuMjc5OTMgbCAwLjAwMyw3NC4xMTI3MiBjIDAsNy40NDAzNyA2LjA4NjU2OSwxMy41Mjc5NiAxMy41MjY5NDgsMTMuNTI3OTYgSCAxODIuNjAzNzQgYyA3LjQ0MDg3LDAgMTMuNTI4OTcsLTYuMDg3NTkgMTMuNTI4OTcsLTEzLjUyNzk2IGwgMC4wMDMsLTc0LjQwMTc1IGMgLTMuODQyNTgsMS43MTM2OCAtOC4wNTI2OCwyLjY1NDg2IC0xMi4zODU5OCwyLjY1NDg2IC05LjI1MDI3LDAgLTE5LjkyNjk2LC00LjI3NzU4IC0yNi41MTUyNCwtMTUuNTg1NTUxIC01LjMzMjY5LDkuNDU5NTcxIC0xNS42NzQ1NywxNS41NTMyMTEgLTI2LjczNDU0LDE1LjU1MzIxMSAtOS4xNjk1NywwIC0yMC44NjAwNCwtNC40MTM5OSAtMjYuOTc5MTEsLTE1Ljc0ODI1NyB6IG0gNDguNzMxMzcsMjcuMjk0NDE3IGMgMjguMzI0NiwwIDQyLjUwNDk3LDM0LjI0MzQgMjIuNDc4ODksNTQuMjY5NDkgLTIwLjAyNjA5LDIwLjAyNjA4IC01NC4yNjk0OSw1Ljg0NTcxIC01NC4yNjk0OSwtMjIuNDc4ODkgMCwtMTcuNTU3NiAxNC4yMzMsLTMxLjc5MDYgMzEuNzkwNiwtMzEuNzkwNiB6IG0gLTAuMTA2MTEsMTQuMzcyODMgYyAtMC45MDk1OCwtMC4wMDggLTEuODI0MzIsMC41ODA0OCAtMS44OTU5LDEuNzcwNTggbCAtMC4wNDE0LDEzLjUyMDg4IC0zLjg3NTY3LC0zLjgzOTI5IGMgLTEuNzg3NzksLTEuNjI2MTcgLTQuMjkwMDgsMC45MzU5MiAtMi42MjI1MiwyLjY4NTE4IGwgNy4wMzY4NCw2Ljk0ODkyIGMgMC43MzI2MiwwLjcxOTIgMS45MDYwNywwLjcxOTIgMi42Mzg2OSwwIGwgNy4xNDA5MywtNy4wNTIgYyAxLjc5Njk0LC0xLjc1NTcgLTAuODQ3NzIsLTQuNDQ3MDIgLTIuNjM0NjQsLTIuNjgxMTQgaCAtMC4wMTAxIGwgLTMuOTExMDQsMy44NjU1NyAwLjA0MTQsLTEzLjQxNjggYyAtMC4wNTE4LC0xLjE5MTEyIC0wLjk1NzAxLC0xLjc5NDM5IC0xLjg2NjU4LC0xLjgwMTkgeiBtIDEzLjE5ODUsMTkuMzAwNTMgYyAtMC45NzQ0MSwtMC4wMDkgLTEuOTU1MTksMC42NDA4IC0xLjg5OTk0LDEuOTYxNTggdiA1LjM5MTU4IGggLTIyLjQwNTExIHYgLTUuMzU1MTkgYyAtMC4wOTk5LC0yLjM4Mjk3IC0zLjYxNTc4LC0yLjQxNjk4IC0zLjc2MTQ3LC0wLjAzNjQgdiA3LjM1ODIyIGggMC4wMjUzIGMgMC4wNDQsMC45OTg5IDAuODYzNzIsMS43ODcwMSAxLjg2MzU2LDEuNzk0ODMgaCAyNi4xNzY2OSBjIDAuOTk4NzgsLTAuMDEgMS44MTYsLTAuNzk3MDggMS44NjI1NCwtMS43OTQ4MyB2IC03LjMyMTgzIGMgMC4wODA3LC0xLjMxOTQ3IC0wLjg4NzEyLC0xLjk4ODYgLTEuODYxNTMsLTEuOTk3OTcgeiIgLz4KCgk8L2c+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K';

	const REST_NAMESPACE = 'sifg/v1';

	private $loaded;

	private $container;

	private $background_process;

	public function __construct($file){
		$this->container = new Container([
			'plugin_basename'       => plugin_basename($file),
			'plugin_domain'         => self::DOMAIN,
			'plugin_path'           => plugin_dir_path($file),
			'plugin_relative_path'  => basename(plugin_dir_path($file)),
			'plugin_url'            => plugin_dir_url($file),
			'plugin_version'        => self::VERSION,
			'plugin_dashicon'       => self::DASHICON,
			'plugin_rest_namespace' => self::REST_NAMESPACE,
		]);
	}

	public static function activate(){

	}



	public static function deactivate(){

	}

	public function is_loaded(){
		return $this->loaded;
	}

	public function init(){
		if($this->is_loaded()){
			return;
		}

		$this->container->configure([
			Configuration\AdminConfiguration::class,
			Configuration\OptionsConfiguration::class,
			Configuration\EventManagementConfiguration::class,
			Configuration\ApiConfiguration::class,
			Configuration\RestApiConfiguration::class,
			Configuration\BackgroundProcessConfiguration::class,
			Configuration\LoggerConfiguration::class,
		]);

		foreach($this->container['subscribers'] as $subscriber){
			$this->container['service.event_manager']->add_subscriber($subscriber);
		}

		$this->background_process = $this->container['service.import_process'];

		$this->loaded = true;
	}


	public function get_container(): Container {
		return $this->container;
	}

	public function get_event_manager(){
		if(!$this->is_loaded()){
			return false;
		}

		return $this->container['service.event_manager'];
	}

	public function get_background_process(){
		return $this->background_process;
	}
}
